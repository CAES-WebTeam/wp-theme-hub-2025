/**
 * Frontend styles for Reveal Block
 *
 * Uses clip-path to create a "window" effect where the fixed background
 * is only visible within the block's bounds, creating smooth scroll behavior.
 */

.caes-reveal {
	position: relative;
	min-height: var(--reveal-min-height, 100vh);

	// clip-path creates a clipping context that clips fixed children to parent bounds
	clip-path: inset(0);

	// Background container - always fixed, clipped by parent
	.reveal-background {
		position: fixed;
		top: 0;
		right: 0;
		height: 100vh;
		z-index: 0;
		overflow: hidden; // Clip frames during directional transitions

		@media screen and (min-width: 768px) {
			// Accounting for sidebar
			width: calc(100% - 222px);
			left: 222px;
		}
	}

	// Individual frames (using figure element for accessibility)
	.reveal-frame {
		position: absolute;
		inset: 0;
		opacity: 0;
		clip-path: inset(0 0 0 0); // Fully clipped by default
		transition-property: opacity, clip-path;
		transition-timing-function: ease-out;
		transition-duration: var(--transition-speed, 500ms);
		will-change: opacity, clip-path;
		margin: 0; // Reset figure default margin

		&.is-active {
			opacity: 1;
		}

		picture {
			display: block;
			width: 100%;
			height: 100%;
		}

		img {
			width: 100%;
			height: 100%;
			object-fit: cover;
			object-position: var(--desktop-focal-x, 50%) var(--desktop-focal-y, 50%);
		}

		// Desktop/Mobile separate image handling
		.reveal-frame-desktop {
			display: block;
			object-position: var(--desktop-focal-x, 50%) var(--desktop-focal-y, 50%);
		}

		.reveal-frame-mobile {
			display: none;
			object-position: var(--mobile-focal-x, 50%) var(--mobile-focal-y, 50%);
		}

		// Caption styling
		.reveal-frame-caption {
			position: absolute;
			bottom: 0;
			left: 0;
			right: 0;
			padding: 1rem 1.5rem;
			background: rgba(0, 0, 0, 0.8);
			color: var(--wp--preset--color--base);
			line-height: 1.4;
			z-index: 3; // Above overlay
			max-width: var(--wp--style--global--wide-size);

			// Desktop caption visible by default
			.reveal-caption-desktop {
				display: block;
			}

			.reveal-caption-mobile {
				display: none;
			}
		}

		// Overlay - inside each frame, between image and caption
		.reveal-overlay {
			position: absolute;
			inset: 0;
			pointer-events: none;
			z-index: 2; // Above image, below caption
		}

		// Mobile: swap which image and caption is visible
		@media screen and (max-width: 768px) {
			img {
				object-position: var(--mobile-focal-x, 50%) var(--mobile-focal-y, 50%);
			}

			.reveal-frame-desktop {
				display: none;
			}

			.reveal-frame-mobile {
				display: block;
			}

			.reveal-frame-caption {
				.reveal-caption-desktop {
					display: none;
				}

				.reveal-caption-mobile {
					display: block;
				}
			}
		}
	}

	// Content container
	.reveal-content {
		position: relative;
		z-index: 2;
		min-height: inherit;

		// Ensure content has some padding by default
		>*:first-child {
			margin-top: 0;
		}

		>*:last-child {
			margin-bottom: 0;
		}
	}

	// Reduced motion: instant transitions
	@media (prefers-reduced-motion: reduce) {
		.reveal-frame {
			transition-duration: 0ms !important;
		}
	}

	// Wide alignment
	&.alignwide {
		.reveal-background {
			left: 0;
			right: 0;
			width: 100vw;
		}
	}
}

// Transition type variations (applied via JS)
.reveal-frame {
	// Fade (default) - just opacity, handled above

	// Wipe transitions - use clip-path for reveal effect
	&[data-transition-type="up"],
	&[data-transition-type="down"],
	&[data-transition-type="left"],
	&[data-transition-type="right"] {
		transition-property: opacity, clip-path;
	}
}

// Accessibility: ensure focus states are visible
.caes-reveal {

	a:focus,
	button:focus {
		outline: 2px solid currentColor;
		outline-offset: 2px;
	}
}

// Print styles - show first frame only, no fixed positioning
@media print {
	.caes-reveal {
		clip-path: none;

		.reveal-background {
			position: absolute !important;
			height: 100%;
		}

		.reveal-frame {
			display: none;

			&:first-child {
				display: block;
				opacity: 1 !important;
			}
		}

		.reveal-overlay {
			display: none;
		}
	}
}