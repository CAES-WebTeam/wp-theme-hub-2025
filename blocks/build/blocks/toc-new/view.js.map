{"version":3,"file":"blocks/toc-new/view.js","mappings":"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","sources":["webpack://theme-blocks/./src/blocks/toc-new/view.js"],"sourcesContent":["window.addEventListener('load', function () {\n    const postContent = document.querySelector('.caes-hub-content-post');\n    if (!postContent) return;\n\n    const tocWrapper = document.querySelector('.wp-block-caes-hub-toc-new');\n    if (!tocWrapper) return;\n\n    const showSubheadings = tocWrapper.dataset.showSubheadings === \"1\";\n    const listStyle = tocWrapper.dataset.listStyle || \"ul\";\n    const title = tocWrapper.dataset.title || \"Table of Contents\";\n\n    const headings = Array.from(postContent.querySelectorAll(showSubheadings ? 'h2, h3, h4, h5, h6' : 'h2'));\n\n    function slugify(text) {\n        return text.toString().trim().toLowerCase()\n            .replace(/\\s+/g, '-')\n            .replace(/[^\\w\\-]+/g, '')\n            .replace(/\\-\\-+/g, '-')\n            .replace(/^-+/, '')\n            .replace(/-+$/, '');\n    }\n\n    function generateUniqueID(baseID, usedIDs) {\n        let uniqueID = baseID;\n        let count = 2;\n        while (usedIDs.has(uniqueID)) {\n            uniqueID = `${baseID}-${count}`;\n            count++;\n        }\n        usedIDs.add(uniqueID);\n        return uniqueID;\n    }\n\n    function createList(isSublist = false) {\n        if (isSublist) {\n            return document.createElement(\"ul\");\n        }\n        if (listStyle === \"ol\") {\n            return document.createElement(\"ol\");\n        }\n        const ul = document.createElement(\"ul\");\n        if (listStyle === \"none\") {\n            ul.classList.add(\"is-style-caes-hub-list-none\");\n        }\n        return ul;\n    }\n\n    function buildTOCs(headings) {\n        if (headings.length === 0) return;\n    \n        const usedIDs = new Set();\n        const tocList = createList();\n        const stickyTocList = createList();\n        const headingMap = new Map();\n    \n        let currentList = tocList;\n        let stickyCurrentList = stickyTocList;\n        let lastLevel = 2;\n    \n        headings.forEach(heading => {\n            const level = parseInt(heading.tagName.substring(1), 10);\n            const baseID = slugify(heading.textContent);\n            const uniqueID = generateUniqueID(baseID, usedIDs);\n            heading.id = uniqueID;\n    \n            const listItem = document.createElement('li');\n            const link = document.createElement('a');\n            link.textContent = heading.textContent;\n            link.href = `#${uniqueID}`;\n            listItem.appendChild(link);\n    \n            const stickyItem = listItem.cloneNode(true);\n    \n            // Reset nesting if it's an H2\n            if (level === 2) {\n                currentList = tocList;\n                stickyCurrentList = stickyTocList;\n            } else if (level > lastLevel) {\n                // Create new sublist only if level increases\n                const newList = createList(true);\n                currentList.lastElementChild?.appendChild(newList);\n                currentList = newList;\n    \n                const newStickyList = createList(true);\n                stickyCurrentList.lastElementChild?.appendChild(newStickyList);\n                stickyCurrentList = newStickyList;\n            }\n    \n            // Append to the lists\n            currentList.appendChild(listItem);\n            stickyCurrentList.appendChild(stickyItem);\n    \n            // Ensure correct mapping between heading ID and sticky item\n            headingMap.set(uniqueID, stickyItem);\n    \n            lastLevel = level;\n        });\n    \n        tocWrapper.appendChild(tocList);\n    \n        // Add sticky TOC before </main>\n        const mainElement = document.querySelector('main');\n        if (mainElement) {\n            const stickyTOC = document.createElement('div');\n            stickyTOC.classList.add('sticky-toc');\n            const tocTitle = document.createElement('h2');\n            tocTitle.textContent = title;\n            stickyTOC.appendChild(tocTitle);\n            stickyTOC.appendChild(stickyTocList);\n            mainElement.appendChild(stickyTOC);\n    \n            return { stickyTOC, headingMap };\n        }\n    \n        return { stickyTOC: null, headingMap };\n    }\n    \n\n    const { stickyTOC, headingMap } = buildTOCs(headings) || {};\n\n    function enableSmoothScroll() {\n        document.addEventListener('click', function (event) {\n            if (event.target.tagName === 'A' && event.target.hash) {\n                event.preventDefault();\n                const targetID = event.target.hash.substring(1);\n                const targetElement = document.getElementById(targetID);\n                if (targetElement) {\n                    targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });\n                }\n            }\n        });\n    }\n    enableSmoothScroll();\n\n    function handleScroll() {\n        if (!stickyTOC) return;\n\n        const tocRect = tocWrapper.getBoundingClientRect();\n        if (tocRect.top < 0) {\n            stickyTOC.classList.add('visible');\n        } else {\n            stickyTOC.classList.remove('visible');\n        }\n    }\n    window.addEventListener('scroll', handleScroll);\n\n    function observeHeadings() {\n        if (!headingMap) return;\n\n        const observer = new IntersectionObserver(entries => {\n            let activeSet = false;\n            entries.forEach(entry => {\n                const id = entry.target.id;\n                if (headingMap.has(id)) {\n                    const tocItem = headingMap.get(id);\n                    if (entry.isIntersecting && !activeSet) {\n                        document.querySelectorAll('.sticky-toc li').forEach(item => {\n                            item.classList.remove('active');\n                        });\n                        tocItem.classList.add('active');\n                        activeSet = true;\n                    }\n                }\n            });\n        }, {\n            rootMargin: '0px 0px -80% 0px',\n            threshold: 0.1\n        });\n\n        headings.forEach(heading => observer.observe(heading));\n    }\n    \n    observeHeadings();\n});\n"],"names":["window","addEventListener","postContent","document","querySelector","tocWrapper","showSubheadings","dataset","listStyle","title","headings","Array","from","querySelectorAll","slugify","text","toString","trim","toLowerCase","replace","generateUniqueID","baseID","usedIDs","uniqueID","count","has","add","createList","isSublist","createElement","ul","classList","buildTOCs","length","Set","tocList","stickyTocList","headingMap","Map","currentList","stickyCurrentList","lastLevel","forEach","heading","level","parseInt","tagName","substring","textContent","id","listItem","link","href","appendChild","stickyItem","cloneNode","newList","lastElementChild","newStickyList","set","mainElement","stickyTOC","tocTitle","enableSmoothScroll","event","target","hash","preventDefault","targetID","targetElement","getElementById","scrollIntoView","behavior","block","handleScroll","tocRect","getBoundingClientRect","top","remove","observeHeadings","observer","IntersectionObserver","entries","activeSet","entry","tocItem","get","isIntersecting","item","rootMargin","threshold","observe"],"sourceRoot":""}