{"version":3,"file":"blocks/toc-new/view.js","mappings":"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","sources":["webpack://theme-blocks/./src/blocks/toc-new/view.js"],"sourcesContent":["window.addEventListener('load', function () {\n    const postContent = document.querySelector('.caes-hub-content-post');\n    if (!postContent) return;\n\n    const tocWrapper = document.querySelector('.wp-block-caes-hub-toc-new');\n    if (!tocWrapper) return;\n\n    const showSubheadings = tocWrapper.dataset.showSubheadings === \"1\";\n    const listStyle = tocWrapper.dataset.listStyle || \"ul\";\n    const title = tocWrapper.dataset.title || \"Table of Contents\";\n\n    // Filter out the h2 element with the same text as the title\n    const headings = Array.from(postContent.querySelectorAll(showSubheadings ? 'h2, h3, h4, h5, h6' : 'h2')).filter(heading => heading.textContent !== title);\n\n    function slugify(text) {\n        return text.toString().trim().toLowerCase()\n            .replace(/\\s+/g, '-')\n            .replace(/[^\\w\\-]+/g, '')\n            .replace(/\\-\\-+/g, '-')\n            .replace(/^-+/, '')\n            .replace(/-+$/, '');\n    }\n\n    function generateUniqueID(baseID, usedIDs) {\n        let uniqueID = baseID;\n        let count = 2;\n        while (usedIDs.has(uniqueID)) {\n            uniqueID = `${baseID}-${count}`;\n            count++;\n        }\n        usedIDs.add(uniqueID);\n        return uniqueID;\n    }\n\n    function createList(isSublist = false) {\n        if (isSublist) {\n            return document.createElement(\"ul\");\n        }\n        if (listStyle === \"ol\") {\n            return document.createElement(\"ol\");\n        }\n        const ul = document.createElement(\"ul\");\n        if (listStyle === \"none\") {\n            ul.classList.add(\"is-style-caes-hub-list-none\");\n        }\n        return ul;\n    }\n\n    function buildTOCs(headings) {\n        if (headings.length === 0) return;\n\n        const usedIDs = new Set();\n        const tocList = createList();\n        const stickyTocList = createList();\n        const headingMap = new Map();\n\n        let currentList = tocList;\n        let stickyCurrentList = stickyTocList;\n        let lastLevel = 2;\n\n        headings.forEach(heading => {\n            const level = parseInt(heading.tagName.substring(1), 10);\n            const baseID = slugify(heading.textContent);\n            const uniqueID = generateUniqueID(baseID, usedIDs);\n            heading.id = uniqueID;\n\n            const listItem = document.createElement('li');\n            const link = document.createElement('a');\n            link.textContent = heading.textContent;\n            link.href = `#${uniqueID}`;\n            listItem.appendChild(link);\n\n            const stickyItem = listItem.cloneNode(true);\n\n            // Reset nesting if it's an H2\n            if (level === 2) {\n                currentList = tocList;\n                stickyCurrentList = stickyTocList;\n            } else if (level > lastLevel) {\n                // Create new sublist only if level increases\n                const newList = createList(true);\n                currentList.lastElementChild?.appendChild(newList);\n                currentList = newList;\n\n                const newStickyList = createList(true);\n                stickyCurrentList.lastElementChild?.appendChild(newStickyList);\n                stickyCurrentList = newStickyList;\n            }\n\n            // Append to the lists\n            currentList.appendChild(listItem);\n            stickyCurrentList.appendChild(stickyItem);\n\n            // Ensure correct mapping between heading ID and sticky item\n            headingMap.set(uniqueID, stickyItem);\n\n            lastLevel = level;\n        });\n\n        tocWrapper.appendChild(tocList);\n\n        // Add sticky TOC before </main>\n        const mainElement = document.querySelector('main');\n        if (mainElement) {\n            const stickyTOC = document.createElement('div');\n            stickyTOC.classList.add('sticky-toc');\n            const tocTitle = document.createElement('h2');\n            tocTitle.textContent = title;\n            stickyTOC.appendChild(tocTitle);\n            stickyTOC.appendChild(stickyTocList);\n            mainElement.appendChild(stickyTOC);\n\n            return { stickyTOC, headingMap };\n        }\n\n        return { stickyTOC: null, headingMap };\n    }\n\n    const { stickyTOC, headingMap } = buildTOCs(headings) || {};\n\n    function enableSmoothScroll() {\n        document.addEventListener('click', function (event) {\n            if (event.target.tagName === 'A' && event.target.hash) {\n                event.preventDefault();\n                const targetID = event.target.hash.substring(1);\n                const targetElement = document.getElementById(targetID);\n                if (targetElement) {\n                    targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });\n                }\n            }\n        });\n    }\n    enableSmoothScroll();\n\n    function handleScroll() {\n        if (!stickyTOC) return;\n    \n        const tocRect = tocWrapper.getBoundingClientRect();\n        const stickyTocRect = stickyTOC.getBoundingClientRect();\n        const postContentRect = postContent.getBoundingClientRect();\n    \n        const tocShouldBeVisible = tocRect.top < 0;\n        const tocBottomHitsPostBottom = stickyTocRect.bottom >= postContentRect.bottom;\n    \n        if (tocShouldBeVisible && !tocBottomHitsPostBottom) {\n            stickyTOC.classList.add('visible');\n        } else {\n            stickyTOC.classList.remove('visible');\n        }\n    }    \n    window.addEventListener('scroll', handleScroll);\n\n    function observeHeadings() {\n        if (!headingMap) return;\n\n        const observer = new IntersectionObserver(entries => {\n            let activeSet = false;\n            entries.forEach(entry => {\n                const id = entry.target.id;\n                if (headingMap.has(id)) {\n                    const tocItem = headingMap.get(id);\n                    if (entry.isIntersecting && !activeSet) {\n                        document.querySelectorAll('.sticky-toc li').forEach(item => {\n                            item.classList.remove('active');\n                        });\n                        tocItem.classList.add('active');\n                        activeSet = true;\n                    }\n                }\n            });\n        }, {\n            rootMargin: '0px 0px -80% 0px',\n            threshold: 0.1\n        });\n\n        headings.forEach(heading => observer.observe(heading));\n    }\n\n    observeHeadings();\n});\n"],"names":["window","addEventListener","postContent","document","querySelector","tocWrapper","showSubheadings","dataset","listStyle","title","headings","Array","from","querySelectorAll","filter","heading","textContent","slugify","text","toString","trim","toLowerCase","replace","generateUniqueID","baseID","usedIDs","uniqueID","count","has","add","createList","isSublist","createElement","ul","classList","buildTOCs","length","Set","tocList","stickyTocList","headingMap","Map","currentList","stickyCurrentList","lastLevel","forEach","level","parseInt","tagName","substring","id","listItem","link","href","appendChild","stickyItem","cloneNode","newList","lastElementChild","newStickyList","set","mainElement","stickyTOC","tocTitle","enableSmoothScroll","event","target","hash","preventDefault","targetID","targetElement","getElementById","scrollIntoView","behavior","block","handleScroll","tocRect","getBoundingClientRect","stickyTocRect","postContentRect","tocShouldBeVisible","top","tocBottomHitsPostBottom","bottom","remove","observeHeadings","observer","IntersectionObserver","entries","activeSet","entry","tocItem","get","isIntersecting","item","rootMargin","threshold","observe"],"sourceRoot":""}