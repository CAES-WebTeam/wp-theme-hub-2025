document.addEventListener("DOMContentLoaded",(function(){class e{constructor(e){this.gallery=e,this.galleryId=e.id;try{const e=this.gallery.dataset.images;this.images=e?JSON.parse(e):[]}catch(e){console.error("Error parsing gallery images data:",e),this.images=[]}this.currentImageIndex=0,this.lastFocusedElement=null,this.modal=this.gallery.querySelector(".lightbox-modal"),this.lightboxImage=this.modal.querySelector(".lightbox-image"),this.lightboxCaption=this.modal.querySelector(".lightbox-caption"),this.closeBtn=this.modal.querySelector(".lightbox-close"),this.prevBtn=this.modal.querySelector(".prev-btn"),this.nextBtn=this.modal.querySelector(".next-btn"),this.backdrop=this.modal.querySelector(".lightbox-backdrop"),this.viewGalleryBtn=this.gallery.querySelector(".view-gallery-btn"),this.galleryTrigger=this.gallery.querySelector(".gallery-trigger"),this.triggerImage=this.gallery.querySelector(".gallery-trigger-image"),this.init()}init(){this.bindEvents()}bindEvents(){this.viewGalleryBtn&&(this.viewGalleryBtn.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),this.openLightbox(0)})),this.viewGalleryBtn.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),this.openLightbox(0))}))),this.galleryTrigger&&this.galleryTrigger.addEventListener("click",(e=>{e.target!==this.triggerImage&&e.target!==this.galleryTrigger||(e.preventDefault(),this.openLightbox(0))})),this.closeBtn&&this.closeBtn.addEventListener("click",(()=>this.closeLightbox())),this.prevBtn&&this.prevBtn.addEventListener("click",(()=>this.goToPrevImage())),this.nextBtn&&this.nextBtn.addEventListener("click",(()=>this.goToNextImage())),this.backdrop&&this.backdrop.addEventListener("click",(()=>this.closeLightbox())),document.addEventListener("keydown",(e=>this.handleGlobalKeydown(e)))}openLightbox(e=0){0!==this.images.length&&(this.currentImageIndex=e,this.lastFocusedElement=document.activeElement,this.updateLightboxImage(),this.modal.setAttribute("aria-hidden","false"),this.modal.style.display="flex",document.body.style.overflow="hidden",document.body.classList.add("lightbox-open"),setTimeout((()=>{this.closeBtn&&this.closeBtn.focus()}),100))}closeLightbox(){this.modal.setAttribute("aria-hidden","true"),this.modal.style.display="none",document.body.style.overflow="",document.body.classList.remove("lightbox-open"),this.lastFocusedElement&&this.lastFocusedElement.focus()}updateLightboxImage(){const e=this.images[this.currentImageIndex];e&&(this.lightboxImage&&(this.lightboxImage.src=e.url,this.lightboxImage.alt=e.alt||""),this.lightboxCaption&&(this.lightboxCaption.innerHTML=e.caption||""),this.prevBtn&&(this.prevBtn.disabled=this.images.length<=1),this.nextBtn&&(this.nextBtn.disabled=this.images.length<=1))}goToNextImage(){this.images.length<=1||(this.currentImageIndex=(this.currentImageIndex+1)%this.images.length,this.updateLightboxImage())}goToPrevImage(){this.images.length<=1||(this.currentImageIndex=(this.currentImageIndex-1+this.images.length)%this.images.length,this.updateLightboxImage())}handleGlobalKeydown(e){if("true"!==this.modal.getAttribute("aria-hidden"))switch(e.key){case"Escape":e.preventDefault(),this.closeLightbox();break;case"ArrowLeft":e.preventDefault(),this.goToPrevImage();break;case"ArrowRight":e.preventDefault(),this.goToNextImage();break;case"Tab":this.handleFocusTrap(e)}}handleFocusTrap(e){const t=[this.closeBtn,this.prevBtn,this.nextBtn].filter((e=>e&&!e.disabled));if(0===t.length)return;const i=t[0],s=t[t.length-1];e.shiftKey?document.activeElement===i&&(e.preventDefault(),s.focus()):document.activeElement===s&&(e.preventDefault(),i.focus())}}document.querySelectorAll(".lightbox-gallery").forEach((t=>{new e(t)}))}));